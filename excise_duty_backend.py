diff --git a/excise_duty_backend.py b/excise_duty_backend.pyindex 0070eca96243ceedfc2b5d2d6f601d27c0f4a2f9..492c39c6828dd77b7090c27955de3ecb3fb6c294 100644--- a/excise_duty_backend.py+++ b/excise_duty_backend.py@@ -3,50 +3,64 @@ Excise Duty Register Backend Database operations and business logic for excise duty tracking """  import sqlite3 from datetime import date, datetime, timedelta from typing import List, Dict, Optional, Tuple from decimal import Decimal import logging  from excise_duty_schema import (     ExciseDutyLedger,     ExciseDutyBottle,     ExciseDutyDailySummary,     CREATE_EXCISE_DUTY_LEDGER_TABLE,     CREATE_EXCISE_DUTY_BOTTLES_TABLE,     CREATE_EXCISE_DUTY_SUMMARY_TABLE,     CREATE_EXCISE_DUTY_INDEXES,     DUTY_RATES,     get_duty_rate_for_strength )  # Configure logging logging.basicConfig(level=logging.INFO) logger = logging.getLogger(__name__) +import desktop_storage+++def _serialize_model(model) -> Dict:+    data = model.model_dump()+    for key, value in data.items():+        if isinstance(value, Decimal):+            data[key] = float(value)+        elif isinstance(value, date):+            data[key] = value.isoformat()+        elif isinstance(value, datetime):+            data[key] = value.isoformat()+    return data+ # Database path DB_PATH = "excise_registers.db"  # ============================================================================ # DATABASE INITIALIZATION # ============================================================================  def init_excise_duty_database():     """Initialize Excise Duty database tables"""     try:         conn = sqlite3.connect(DB_PATH)         cursor = conn.cursor()                  # Create tables         cursor.executescript(CREATE_EXCISE_DUTY_LEDGER_TABLE)         cursor.executescript(CREATE_EXCISE_DUTY_BOTTLES_TABLE)         cursor.executescript(CREATE_EXCISE_DUTY_SUMMARY_TABLE)         cursor.executescript(CREATE_EXCISE_DUTY_INDEXES)                  conn.commit()         conn.close()         logger.info("✅ Excise Duty database initialized successfully")         return True     except Exception as e:         logger.error(f"❌ Error initializing Excise Duty database: {e}")@@ -121,50 +135,51 @@ def save_duty_ledger(ledger: ExciseDutyLedger) -> bool:                 ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)             """, (                 str(ledger.date),                 float(ledger.opening_balance),                 float(ledger.deposit_amount),                 ledger.echallan_no,                 str(ledger.echallan_date) if ledger.echallan_date else None,                 float(ledger.amount_credited),                 ledger.name_of_issue,                 ledger.warehouse_no,                 ledger.transport_permit_no,                 float(ledger.total_duty_amount),                 float(ledger.duty_debited),                 float(ledger.closing_balance),                 ledger.remarks,                 ledger.excise_officer_name,                 ledger.excise_officer_signature,                 ledger.status,                 now,                 now             ))                  conn.commit()         conn.close()         logger.info(f"✅ Duty ledger saved for {ledger.date}")+        desktop_storage.save_excise_ledger_to_excel(_serialize_model(ledger))         return True     except Exception as e:         logger.error(f"❌ Error saving duty ledger: {e}")         return False   def get_duty_ledger(target_date: date) -> Optional[ExciseDutyLedger]:     """Get duty ledger for a specific date"""     try:         conn = sqlite3.connect(DB_PATH)         conn.row_factory = sqlite3.Row         cursor = conn.cursor()                  cursor.execute("SELECT * FROM excise_duty_ledger WHERE date = ?", (str(target_date),))         row = cursor.fetchone()         conn.close()                  if row:             return ExciseDutyLedger(                 duty_id=row['duty_id'],                 date=datetime.strptime(row['date'], '%Y-%m-%d').date(),                 opening_balance=Decimal(str(row['opening_balance'])),                 deposit_amount=Decimal(str(row['deposit_amount'])),                 echallan_no=row['echallan_no'],                 echallan_date=datetime.strptime(row['echallan_date'], '%Y-%m-%d').date() if row['echallan_date'] else None,@@ -249,50 +264,51 @@ def save_duty_bottle(bottle: ExciseDutyBottle) -> bool:                 INSERT INTO excise_duty_bottles (                     duty_id, date, product_name, strength, bottle_size_ml,                     qty_issued, bl_issued, al_issued,                     duty_rate_per_bl, duty_amount,                     status, created_at, updated_at                 ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)             """, (                 bottle.duty_id,                 str(bottle.date),                 bottle.product_name,                 float(bottle.strength),                 bottle.bottle_size_ml,                 bottle.qty_issued,                 float(bottle.bl_issued),                 float(bottle.al_issued),                 float(bottle.duty_rate_per_bl),                 float(bottle.duty_amount),                 bottle.status,                 now,                 now             ))                  conn.commit()         conn.close()         logger.info(f"✅ Duty bottle saved for {bottle.date} - {bottle.product_name} ({bottle.bottle_size_ml}ml)")+        desktop_storage.save_excise_bottle_to_excel(_serialize_model(bottle))         return True     except Exception as e:         logger.error(f"❌ Error saving duty bottle: {e}")         return False   def get_duty_bottles_for_date(target_date: date) -> List[ExciseDutyBottle]:     """Get all duty bottle issues for a specific date"""     try:         conn = sqlite3.connect(DB_PATH)         conn.row_factory = sqlite3.Row         cursor = conn.cursor()                  cursor.execute("SELECT * FROM excise_duty_bottles WHERE date = ? ORDER BY product_name, bottle_size_ml", (str(target_date),))         rows = cursor.fetchall()         conn.close()                  bottles = []         for row in rows:             bottles.append(ExciseDutyBottle(                 duty_bottle_id=row['duty_bottle_id'],                 duty_id=row['duty_id'],                 date=datetime.strptime(row['date'], '%Y-%m-%d').date(),                 product_name=row['product_name'],                 strength=Decimal(str(row['strength'])),